<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>é è¨‚è³‡æ–™å¡«å¯«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    header {
      background: #06c755;
      color: #fff;
      padding: 16px;
      font-size: 22px;
      font-weight: 900;
      text-align: center;
    }

    .container {
      max-width: 560px;
      margin: 0 auto;
      padding: 16px;
    }

    .field {
      margin-bottom: 14px;
    }
    .field label {
      font-weight: 700;
      margin-bottom: 6px;
      display: block;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    textarea {
      height: 80px;
      resize: vertical;
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: #06c755;
      color: white;
      font-size: 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 900;
      margin-top: 12px;
    }

    .summary {
      background: #fff;
      padding: 16px;
      border-radius: 12px;
      margin-top: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .hidden { display: none; }
  </style>
</head>

<body>

<header>é è¨‚è³‡æ–™å¡«å¯«</header>

<div class="container">

  <!-- é¤¨åˆ¥ -->
  <div class="field">
    <label>é¤¨åˆ¥</label>
    <input id="house" readonly>
  </div>

  <!-- æˆ¿å‹ -->
  <div class="field">
    <label>æˆ¿å‹</label>
    <input id="room" readonly>
  </div>

  <!-- å…¥ä½æ—¥ -->
  <div class="field">
    <label>å…¥ä½æ—¥æœŸ</label>
    <input id="date" type="text" readonly>
  </div>

  <!-- å¤©æ•¸ -->
  <div class="field">
    <label>ä½å®¿å¤©æ•¸</label>
    <input id="nights" type="number" min="1" value="1">
  </div>

  <!-- å¤§äºº -->
  <div class="field">
    <label>å¤§äººäººæ•¸</label>
    <input id="adult" type="number" min="1" value="2">
  </div>

  <!-- å°å­© -->
  <div class="field">
    <label>å°å­©æ•¸é‡</label>
    <input id="child" type="number" min="0" value="0">
  </div>

  <!-- å§“å -->
  <div class="field">
    <label>å§“åï¼ˆå¿…å¡«ï¼‰</label>
    <input id="name" type="text" placeholder="è«‹è¼¸å…¥å§“å">
  </div>

  <!-- Email -->
  <div class="field">
    <label>Emailï¼ˆé¸å¡«ï¼Œæœƒå¯„é è¨‚æ‘˜è¦ï¼‰</label>
    <input id="email" type="email" placeholder="example@gmail.com">
  </div>

  <!-- æ‰‹æ©Ÿ -->
  <div class="field">
    <label>æ‰‹æ©Ÿè™Ÿç¢¼ï¼ˆå¿…å¡«ï¼‰</label>
    <input id="phone" type="tel" maxlength="10" placeholder="0912345678">
  </div>

  <!-- å‚™è¨» -->
  <div class="field">
    <label>å‚™è¨»</label>
    <textarea id="note"></textarea>
  </div>

  <button class="btn-primary" id="btnSubmit">é€å‡ºé è¨‚</button>

  <div id="summaryBox" class="summary hidden"></div>

</div>

<script>
const API_URL =
  "https://script.google.com/macros/s/AKfycbxAhWFD3rLv2O1RSnmEA3EJjXIK5vFKja4IHGtL8EW3q-6ZD77K1Emc_ryFAK1fOZKA/exec";

/************************************************
 * è®€å– URL åƒæ•¸
 ************************************************/
function getQuery() {
  const p = new URLSearchParams(location.search);
  return {
    house: p.get("house") || "",
    room: p.get("room") || "",
    date: p.get("date") || ""
  };
}

/************************************************
 * é é¢åˆå§‹åŒ–
 ************************************************/
document.addEventListener("DOMContentLoaded", () => {
  const q = getQuery();

  document.getElementById("house").value = q.house;
  document.getElementById("room").value = q.room;
  document.getElementById("date").value = q.date;

  document.getElementById("btnSubmit").addEventListener("click", submitBooking);
});

/************************************************
 * é€å‡ºé è¨‚
 ************************************************/
async function submitBooking() {
  const data = {
    action: "createBooking",
    uid: "WEB",
    house: house.value,
    roomType: room.value,
    date: date.value,
    nights: Number(nights.value),
    adult: Number(adult.value),
    child: Number(child.value),
    name: name.value.trim(),
    email: email.value.trim(),
    phone: phone.value.trim(),
    note: note.value.trim()
  };

  if (!data.name) { alert("è«‹è¼¸å…¥å§“å"); return; }
  if (!/^09\d{8}$/.test(data.phone)) {
    alert("æ‰‹æ©Ÿæ ¼å¼éŒ¯èª¤"); return;
  }

  // å‘¼å«å¾Œç«¯
  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(data)
  });

  const json = await res.json();

  if (!json.success) {
    alert("é è¨‚å¤±æ•—ï¼š" + json.error);
    return;
  }

  const id = json.id;
  showSummary(data, id);
}

/************************************************
 * é¡¯ç¤ºæ‘˜è¦
 ************************************************/
function showSummary(d, id) {
  const box = document.getElementById("summaryBox");
  box.classList.remove("hidden");

  box.innerHTML = `
ğŸ“Œ è¨‚å–®ç·¨è™Ÿï¼š${id}
å§“åï¼š${d.name}
æ‰‹æ©Ÿï¼š${d.phone}
Emailï¼š${d.email || "â€”"}
é¤¨åˆ¥ï¼š${d.house}
æˆ¿å‹ï¼š${d.roomType}
å…¥ä½æ—¥ï¼š${d.date}
ä½å®¿ï¼š${d.nights} æ™š
äººæ•¸ï¼šå¤§äºº ${d.adult} / å°å­© ${d.child}
å‚™è¨»ï¼š${d.note || "â€”"}

æ‚¨çš„é è¨‚å·²é€å‡ºï¼ŒEmailï¼ˆå¦‚æœ‰å¡«å¯«ï¼‰æœƒæ”¶åˆ°æ‘˜è¦é€šçŸ¥ã€‚
  `;
}
</script>

</body>
</html>
